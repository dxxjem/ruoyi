# 产品需求文档 (PRD) - 智能文档合规性检查平台

| 项目名称 | 智能文档合规性检查平台 (Intelligent Compliance Audit Platform) |
| :--- | :--- |
| **版本号** | V2.0 |
| **文档状态** | 待评审 |
| **最后更新日期** | 2025-12-26 |
| **密级** | 内部公开 |

---

## 1. 项目背景与目标

### 1.1 背景
当前企业内部（特别是工业、国企背景）存在大量文档（如标书、技术规格书、公文、验收报告）需要符合严格的国标（GB）、行标（GJB/HB）及内部质量/安全红线要求。目前主要依赖人工审核，存在效率低、易漏查、标准掌握不一致等痛点。

### 1.2 核心目标
构建一个 B/S 架构的智能辅助工具，利用 **“规则引擎 + 多策略 RAG”** 技术，实现对 Word/PDF 文档的条款级合规性检查，输出人工可确认的审查清单，旨在降低人工复核成本 **70%** 以上，并提升合规检查的覆盖率与准确性。

---

## 2. 总体业务流程

1.  **规则配置**：管理员上传法规文件，系统解析并定义检查策略（如：结构化检查、逻辑推演等）。
2.  **任务提交**：用户上传待检文档（Word/PDF），选择适用的规则集。
3.  **智能解析**：系统对文档进行 OCR、版面分析、文档树构建和元数据提取。
4.  **策略路由与执行**：系统根据每条规则的属性，自动分发到不同的检查管道（正则/结构化RAG/HyDE等）并行处理。
5.  **人工复核**：用户在“双屏工作台”查看结果，联动原文，确认问题或标记误报。
6.  **报告生成**：导出最终的整改报告（Excel清单或带批注的原文件）。

---

## 3. 功能需求详解 (Functional Requirements)

### 3.1 模块一：动态法规库 (Knowledge Base Manager)
**用户角色**：规则管理员
**功能描述**：维护检查依据，是系统的“大脑”，支持规则的动态录入与策略配置。

* **F1.1 法规导入**
    * 支持上传 PDF/Word 格式的法规文件。
    * 支持解析红头文件、国标文档。
* **F1.2 条款拆解与策略定义（核心）**
    * 系统自动将法规拆解为独立条款。
    * **策略标签配置**：每一条规则需配置（支持 AI 推荐 + 人工修正）其对应的 **检查策略**：
        * `Strategy_A: Hard_Check` (**硬规则**)：针对字体、字号、敏感关键词。
        * `Strategy_B: Structural_RAG` (**位置敏感**)：针对规定了特定章节/页码的规则（如“第三章必须包含...”）。
        * `Strategy_C: Context_RAG` (**逻辑推演**)：针对需要理解上下文的复杂规则（如流程合理性）。
        * `Strategy_D: HyDE_Check` (**完整性**)：针对“必须包含...”的缺项检查。
        * `Strategy_E: Hybrid_Search` (**强术语**)：针对包含特定标准号、参数数值的规则。
* **F1.3 规则集管理**
    * 支持将多条规则打包为“检查方案”（如：XX 项目标书检查专用包）。
    * 支持规则的版本控制。

### 3.2 模块二：AI 模型网关 (AI Model Gateway)
**用户角色**：系统管理员
**功能描述**：屏蔽底层模型差异，解决部署灵活性和数据安全性问题。

* **F2.1 双模式切换**
    * **公有云模式**：配置 API Key (OpenAI / DeepSeek / Azure)，支持设置 HTTP Proxy。
    * **私有化模式**：配置内网 Endpoint (vLLM / Ollama / TGI)，适配 Llama3, Qwen 等开源模型。
* **F2.2 脱敏开关**
    * 支持在请求发送给外部 LLM 前，通过正则自动替换敏感实体（如人名、手机号、IP 地址、项目代号）为掩码（如 `[NAME]`, `[ID]`）。

### 3.3 模块三：混合检查引擎 (The Hybrid Engine)
**用户角色**：后台自动执行
**功能描述**：系统的核心执行层，基于“多策略路由”实现高精度检查。

#### F3.1 文档深度解析 (Document Parser)
* **格式支持**：`.docx`, `.pdf` (集成 OCR 处理扫描件)。
* **结构树生成**：必须提取 `Section Hierarchy`（章节层级），建立“文本 - 页码 - 章节”的映射索引。
* **多粒度切片 (Chunking)**：
    * **Child Chunk** (100-200 tokens): 用于高精度检索匹配。
    * **Parent Chunk** (800-1500 tokens): 用于送入 LLM 进行语义理解。

#### F3.2 多策略路由执行 (Strategy Router)
系统遍历选定规则集中的每一条规则，根据 F1.2 定义的策略标签，分发任务：

1.  **管道 A (Hard Rules)**：
    * 运行 Python/Regex 脚本，直接比对元数据（如页边距、必须存在的关键词）。
2.  **管道 B (Structural RAG)**：
    * **Input**: 规则 + 目标章节元数据。
    * **Action**: 在特定章节范围内（如 `WHERE section LIKE '3.%'`）进行检索，防止张冠李戴。
3.  **管道 C (Context/Parent-Child RAG)**：
    * **Input**: 规则 + 检索到的 Child Chunks。
    * **Action**: 命中子块后，自动回溯获取 Parent Chunk，输入 Prompt 让 AI 判别逻辑，提供完整语境。
4.  **管道 D (HyDE - 缺项检查)**：
    * **Input**: 规则（e.g., “必须包含RTO”）。
    * **Action**: LLM 生成“假设性完美片段” -> 向量检索 -> 若相似度低于阈值(如 0.6)，判定为缺失风险。
5.  **管道 E (Hybrid Search)**：
    * **Input**: 规则（含专有名词/参数）。
    * **Action**: 关键词检索 (BM25) + 向量检索 (Embedding) -> RRF (Reciprocal Rank Fusion) 加权排序 -> LLM 验证。

### 3.4 模块四：人工复核工作台 (Audit Workbench)
**用户角色**：业务审核人员
**功能描述**：高效的交互式界面，用于确认机器检查结果。

* **F4.1 分屏布局**
    * 左侧：文档预览（PDF/Word 原文渲染）。
    * 右侧：检查结果列表（条款级）。
* **F4.2 智能定位与高亮**
    * 点击右侧报错卡片，左侧文档自动滚动至对应页码。
    * **颜色编码**：红色（高置信度/硬伤），黄色（低置信度/建议复核）。
* **F4.3 证据卡片 (右侧列表)**
    * 显示内容：`[违规等级]`、`[对应规则原文]`、`[文档中的违规片段]`、`[AI 判定理由]`。
    * **上下文折叠**：对于使用了 Parent-Child RAG 的结果，支持展开查看前后文。
    * 操作按钮：`[确认]`、`[忽略]`（标记误报）、`[一键修订建议]`。
* **F4.4 进度保存**
    * 支持中断审核，自动保存当前审核状态。

### 3.5 模块五：报告与输出 (Reporting)
* **F5.1 在线仪表盘**
    * 展示文档合规得分、问题分布统计（按严重程度、按规则类别）。
* **F5.2 差异清单 (Excel)**
    * 包含字段：页码、问题描述、违反条款名称、整改建议。
* **F5.3 批注版原件 (Annotated File)**
    * 系统将确认后的问题，以 Word/PDF “批注”的形式插入原文件，方便作者直接下载修改。

---

## 4. 非功能性需求 (NFR)

### 4.1 性能要求
* **响应时间**：50 页文档的完整自动化检查耗时 < **3 分钟**（私有化部署 T4 GPU 环境下）。
* **流式反馈**：检查过程中，前端需通过 WebSocket 实时展示已发现的问题，无需等待全部规则跑完。

### 4.2 准确性指标
* **格式类 (Hard Rules)**：准确率 **100%**。
* **内容类 (AI RAG)**：
    * **召回率 (Recall)**：> **85%** (确保主要问题不漏)。
    * **准确率 (Precision Top-3)**：> **70%** (减少用户查看误报的疲劳感)。
    * **缺失项检查**：宁可误报，不可漏报。

### 4.3 安全要求
* **数据留存**：支持配置任务完成后“立即删除”源文件或“保留 X 天”。
* **操作审计**：所有人工的“忽略/确认”操作必须记录日志，用于后续审计追溯及模型微调。

---

## 5. 数据结构示例 (JSON Schema)

以下是 **核心规则对象** 的定义示例，用于指导后端数据库设计：

```json
{
  "rule_id": "R_SEC_005",
  "rule_content": "所有涉及用户隐私数据的章节，必须明确描述数据脱敏方式。",
  "category": "数据安全",
  "severity": "High",
  "check_strategy": "Parent_Child_RAG", 
  "strategy_config": {
    "target_scope": "GLOBAL", 
    "keywords": ["隐私", "身份证", "脱敏"], 
    "similarity_threshold": 0.75
  },
  "created_by": "admin",
  "last_updated": "2025-12-26"
}